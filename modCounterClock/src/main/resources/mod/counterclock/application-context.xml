
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd">

    <bean id="mod.counterclock.mainscreencontroller" class="com.navid.trafalgar.mod.counterclock.CounterClockMainScreen" autowire="byType"/>
    <bean id="mod.counterclock.mainscreengenerator" class="com.navid.trafalgar.mod.counterclock.CounterClockMainScreenGenerator" autowire="byType" />

    <bean id="mod.counterclock.mapselector" class="com.navid.trafalgar.mod.counterclock.ScreenSelectMap" autowire="byType"/>
    <bean id="mod.counterclock.mapselectorgenerator" class="com.navid.trafalgar.mod.counterclock.ScreenSelectMapGenerator" autowire="byType"/>
    
    <bean id="mod.counterclock.profileselector" class="com.navid.trafalgar.mod.counterclock.SelectProfileScreenController" autowire="byType"/>
    <bean id="mod.counterclock.profileselectorgenerator" class="com.navid.trafalgar.mod.counterclock.SelectProfileScreenGenerator" autowire="byType"/>
    <bean id="mod.counterclock.profilemanager" class="com.navid.trafalgar.mod.counterclock.profile.FileProfileManager" autowire="byType" init-method="loadFromFile">
        <property name="userCommandsClient" ref="mod.counterclock.clientUser"></property>
    </bean>
    
    <bean id="mod.counterclock.persistence" class="com.navid.trafalgar.persistence.localfile.FileRecordPersistenceService" autowire="byType" />
    <bean id="mod.counterclock.persistenceOnline" class="com.navid.trafalgar.persistence.recordserver.RecordServerPersistenceService" autowire="byType">
        <property name="rankingClient" ref="mod.counterclock.clientRecordServer"></property>
        <property name="container" ref="mod.counterclock.requestContextContainer" />
    </bean>

    <bean id="jacksonMapper" class="org.codehaus.jackson.map.ObjectMapper"/>
    <bean id="mod.counterclock.clientRecordServer" class="com.navid.recordserver.v1.RankingResource" factory-bean="mod.counterclock.clientFactoryRecordServer" factory-method="create" />
    <bean id="mod.counterclock.clientFactoryRecordServer" class="org.apache.cxf.jaxrs.client.JAXRSClientFactoryBean">
        <property name="address" value="http://recordserver.trafalgar.ws:8080/rest"/>
        <property name="serviceClass" value="com.navid.recordserver.v1.RankingResource"/>
        <property name="providers">
            <list>
                <ref bean="jacksonMapper"/>
                <bean class="org.codehaus.jackson.jaxrs.JacksonJsonProvider">
                    <property name="mapper" ref="jacksonMapper" />
                </bean>
            </list>
        </property>
        <property name="outInterceptors">
            <list>
                <bean class="com.navid.lazylogin.context.interceptors.RequestIdInterceptor">
                    <property name="requestContextContainer" ref="mod.counterclock.requestContextContainer"/>
                </bean>
            </list>
        </property>
    </bean>
    <bean id="mod.counterclock.requestContextContainer" class="com.navid.lazylogin.context.RequestContextContainer" />

    <bean id="mod.counterclock.clientUser" class="com.lazylogin.client.user.v0.UserCommands" factory-bean="mod.counterclock.clientUserFactory" factory-method="create"/>
    <bean id="mod.counterclock.clientUserFactory" class="org.apache.cxf.jaxws.JaxWsProxyFactoryBean">
        <property name="serviceClass" value="com.lazylogin.client.user.v0.UserCommands"/>
        <property name="address" value="http://lazylogin.ws:8080/services/user"/>
        <property name="handlers">
            <list>
                <bean class="com.navid.lazylogin.context.interceptors.RequestIdHandler">
                    <property name="requestContextContainer" ref="mod.counterclock.requestContextContainer"/>
                </bean>
            </list>
        </property>
    </bean>
    
    
</beans>